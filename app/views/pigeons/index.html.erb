
<div class="container py-3" data-controller="refresh">
  <h1>Search your pigeons</h1>

  <div class="row">
    <div class="my-3">
      <%# <div class="d-flex align-items-center"> %>
        <%= form_with url: pigeons_path, method: :get, data: { refresh_target: "form" } do %>
          <div class="my-5" >
            <%= text_field_tag :query,
                  params[:query],
                  class: "form-control",
                  size:10,
                  placeholder: "Type a keyword",
                  data: {
                    refresh_target: "input",
                    action: "keyup->refresh#update"
                  }%>
          </div>
          <%# <div class="d-flex"> %>
          <div class="row">
            <div class="d-flex justify-content-center">
              <% @alltags.each do |tag| %>
                <input type="checkbox" id="<%= tag %>" data-refresh-target="checkbox" data-action="change->refresh#add" name="q[tags_name_cont_any][]" value="<%= tag %>" class="checkboxaspill tag-selector" <%= params.dig(:q, :tags_name_cont_any)&.include?(tag) ? 'checked' : '' %>>
                <label for="<%= tag %>" class="tag-button"><%= tag %></label>
              <% end %>
            </div>
            <div class="d-flex justify-content-center">
              <% @mediatypes.each do |mt| %>
                <input type="checkbox" id="<%= mt %>"  data-action="change->refresh#media" name="q[media_type][]" value="<%= mt %>" class="checkboxaspill media-type-selector" <%= params.dig(:q, :media_type)&.include?(mt) ? 'checked' : '' %>>
                <label for="<%= mt %>" class="media-type-button"><%= mt %></label>
              <% end %>
            </div>
            <div class="d-flex justify-content-center">
              <%= submit_tag "Refine Search", name: "", class: "btn btn-dark mt-3 px-4", style: "background-color: black; box-shadow: 1px 1px 1px 1px gray; border-radius: 5px; font-size: 1.5rem;" %>
            </div>
          </div>
          <% end %>
          <%= link_to "Clear selection", pigeons_path, data: { turbo_method: :get }  %>
    </div>
  </div>
</div>
      <div class="" data-refresh-target="list" >
        <%#= render "pigeons/list" %>
          <div class="pigeons-container" data-refresh-target="list" >
</div>
  <% if @pigeons == [] %>
    <p>Oops, too specific. No pigeons satisfy this query</p>
  <% else %>
    <div class="pigeons-container px-2" >
      <div class="" style="display: grid; ">
        <div>
          <% @pigeons.each do |pigeon| %>

            </div>
            <div class="d-flex">
              <% @pigeons.each do |pigeon| %>
                  <%#= link_to pigeon.title, mark_read_path(pigeon), data: { turbo_method: :patch } %>
                    <%# <i class="fa-solid fa-heart heart offset-icon"></i> %>
                    <div class="pigeon-card-with-details">
                <%# if pigeon.favourite? %>
                  <%#= link_to mark_read_path(pigeon), data: { turbo_method: :patch }  do%>
                      <div class="d-flex justify-content-between">
                        <div class="sender-date-info">
                          <div style="border-radius: 50px; height: 30px; width: 30px; overflow: hidden; background: gray;">
                            <% if pigeon.user.avatar.attached? %>
                              <%= cl_image_tag @pigeon.user.avatar.key, height: 30, width:30, crop: :fill %>
                              <% else %>
                              <%= image_tag("https://img.freepik.com/free-vector/businessman-character-avatar-isolated_24877-60111.jpg?w=2000", height:30, width:30) %>
                            <% end %>
                          </div>
                          <p class="mt-2">@<%= pigeon.user.nickname %></p>
                          <p class="m-0"><%= pigeon.date.strftime("%a %b %e") %></p>
                        </div>
                        <div>
                          <%= link_to pigeon_path(pigeon), data: {turbo_method: :delete, turbo_confirm: "Are you sure?"} do %>
                            <i class="fa fa-times delete-cross"></i>
                          <% end %>
                        </div>
                      </div>
                      <div class="mt-3">
                          <% @tags = pigeon.tag_names %>
                          <ul style="padding-left: 0px;">
                            <% @tags.each do |tag| %>
                              <li><%= tag %></li>
                            <% end %>
                          </ul>
                      </div>
                      <h3><%= pigeon.title.truncate(23) %></h3>
                      <div class="d-flex align-items-center ">
                        <div>
                          <% if pigeon.favourite? %>
                            <%= link_to link_favourite_path(pigeon), data: { turbo_method: :patch } do %>
                            <p><i class="fa-solid fa-heart"></i></p>
                            <% end %>
                          <% else %>
                            <%= link_to link_favourite_path(pigeon), data: { turbo_method: :patch } do %>
                            <p> <i class="fa-regular fa-heart"></i> </p>
                            <% end %>
                          <% end %>
                        </div>
                        <div>
                          <% if pigeon.read? %>
                            <%= link_to link_read_path(pigeon), data: { turbo_method: :patch }  do %>
                              <i class="fa-solid fa-folder"></i>
                            <% end %>
                          <% else %>
                            <%= link_to link_read_path(pigeon), data: { turbo_method: :patch } do %>
                              <i class="fa-solid fa-folder-open"></i>
                            <% end %>
                          <% end %>
                        </div>
                      </div>
                      <div class="">
                            <% if pigeon.media_type == "video" %>
                                <p><i class="fa-brands fa-youtube pigeon-card-media"></i></p>
                            <% elsif pigeon.media_type == "article" %>
                                <p><i class="fa-regular fa-newspaper pigeon-card-media"></i></p>
                            <% elsif pigeon.media_type == "book" %>
                                <p><i class="fa-solid fa-book pigeon-card-media"></i></p>
                            <% elsif pigeon.media_type == "podcast"%>
                                <p><i class="fa-solid fa-headphones pigeon-card-media"></i></p>
                            <% elsif pigeon.media_type == "audio" || "song" || "playlist"%>
                                <p><i class="fa-solid fa-music pigeon-card-media"></i></p>
                            <% elsif pigeon.media_type == "movie"%>
                                <p><i class="fa-solid fa-film pigeon-card-media"></i></p>
                            <% end %>
                        </div>

                      </div>
                    </div>
                    <%# end %>
                <% end %>
              <% end %>
          <% end %>
        </div>
      </div>
  <%# end %>

    </div>

      </div>
    </div>
  </div>



</div>
