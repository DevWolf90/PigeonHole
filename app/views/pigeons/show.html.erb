<div class="container">
  <% @pigeon.id %>
  <h2 class="mt-4">Pigeon Details</h2>
    <p class="mt-4"><%= @pigeon.title %></p>
    <p><%= @pigeon.description %></p>
    <% if @pigeon.chat.sender == current_user  %>
      <% @sender = @pigeon.chat.recipient %>
    <% else %>
      <% @sender = @pigeon.chat.sender %>
    <% end %>
    <p>Sent on <%= @pigeon.date.strftime("%a, %-d %B %Y") %> at <%= @pigeon.date.strftime("%H:%M")%> by <%=@sender.nickname%></p>
    <p>
      <% if @pigeon.media_type == "video" %>
        <i class="fa-brands fa-youtube"></i></p>
      <% elsif @pigeon.media_type == "article" %>
        <i class="fa-regular fa-newspaper"></i></p>
      <% elsif @pigeon.media_type == "book" %>
        <i class="fa-solid fa-book"></i></p>
      <% elsif @pigeon.media_type == "podcast" || "audio" || "song" || "playlist"%>
        <i class="fa-solid fa-headphones"></i></p>
      <% end %>
    <p>Summary by AI: <%= @pigeon.summary %></p>
    <p>This pigeon will take <%=  TimeToReadService.new(@pigeon.link_to_content).call %> minutes to look at.</p>
    <% if @pigeon.favourite? %>
      <%= link_to toggle_favourite_path(@pigeon), data: { turbo_method: :patch } do %>
        <p><i class="fa-solid fa-heart"></i></p>
      <% end %>
    <% else %>
       <%= link_to toggle_favourite_path(@pigeon), data: { turbo_method: :patch } do %>
         <p> <i class="fa-regular fa-heart"></i> </p>
       <% end %>
    <% end %>

    <p class= "mt-5 mb-5">
      <% @tags = @pigeon.tag_names %>
      <% @tags.each do |tag| %>
        <%= tag %>
      <% end %>
    </p>
    <%= link_to "Link", @pigeon.link_to_content, target: "_blank" %><br>
    <%= link_to "Browse all pigeons", pigeons_path %>
  <div class = "chatWindow">
    <div id="messages" data-controller="chat-scroll">
        <% @pigeon.chat.messages.each do |message| %>
            <%= render 'messages/message', message: message, scroll:message.content == @pigeon.description  %>
        <% end %>
    </div>

    </div>
    <%= simple_form_for [@chat, @message],
        html: {class: "d-flex pt-3"} do |f| %>
        <%= f.input :content,
          as: :string,
          label: false,
          placeholder: "Drop a few lines",
          wrapper_html: {class: "flex-grow-1"}
        %>
        <%= f.submit "Send", class: "btn btn-primary mb-3" %>
        <% end %>
    <% if @pigeon.read %>
      <p>Status: read</p>
      <%= link_to "Mark as unread", toggle_read_path(@pigeon), data: { turbo_method: :patch }  %>
    <% else %>
      <p>Status: unread</p>
      <%= link_to "Mark as read", toggle_read_path(@pigeon), data: { turbo_method: :patch } %>
    <% end %>
     <% unless @pigeon.reply_later %>
      <%= link_to "Reply Later", add_to_reply_path(@pigeon), data: { turbo_method: :patch }  %>
    <% end %>


    <%= link_to "Back to Pigeons", pigeons_path %>
    <%= link_to "Browse all pigeons", pigeons_path %><br>
    <%= link_to "Delete", pigeon_path(@pigeon), data: {turbo_method: :delete, turbo_confirm: "Are you sure?"} %>

</div>
