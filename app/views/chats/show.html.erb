<%= turbo_stream_from @chat %>

<div class="container chat">
 <%# need to fix next line so it says who we're chatting with  %>
 <% @sender = Chat.find(params[:id]).sender  %>
 <% @recipient = Chat.find(params[:id]).recipient%>
 <% if current_user == @sender || current_user == @recipient %>
 <% @chatting_partner = [@sender, @recipient].reject{ |n| n == current_user } %>
  <h1>You're chatting with <%=@chatting_partner[0].nickname%></h1>

  <div id="messages">
    <% @chat.messages.each do |message| %>
      <%= message.sender.nickname %>
      <%= render 'messages/message', message: message %>
      <% @pigeons.each do |pigeon| %>
        <% if pigeon.description == message.content && pigeon.chat_id == message.chat_id%>
        <%= render "pigeons/pigeoncardwithnodetails",  %>
      <% end %>
      <% end %>
    <% end %>
  </div>

  <%= simple_form_for [@chat, @message],
  html: {class: "d-flex"} do |f| %>
  <%= f.input :content,
    as: :string,
    label: false,
    placeholder: "Message ##{@chat.id}",
    wrapper_html: {class: "flex-grow-1"}
  %>
  <%= f.submit "Send", class: "btn btn-primary mb-3" %>
  <% end %>
  <% else %>
  <h1>Get your nosy ass outta here!</h1>

<% end %>
</div>
